{% style %}
  #shopify-section-{{ section.id }} {
    --section-margin-top: {{ section.settings.margin_top }}px;
    --section-margin-bottom: {{ section.settings.margin_bottom }}px;
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    --gradient-background: {% if section.settings.gradient_background != blank %}{{ section.settings.gradient_background }}{% else %}{{ section.settings.colors_background }}{% endif %};
    --color-background: {{ section.settings.colors_background.red }}, {{ section.settings.colors_background.green }}, {{ section.settings.colors_background.blue }};
    --color-foreground: {{ section.settings.colors_text.red }}, {{ section.settings.colors_text.green }}, {{ section.settings.colors_text.blue }};
    --color-link: var(--color-foreground);
    --color-border: var(--color-foreground);
    --color-heading: var(--color-foreground);
    --color-button-background: {{ section.settings.colors_button_background.red }}, {{ section.settings.colors_button_background.green }}, {{ section.settings.colors_button_background.blue }};
    --color-button-text: {{ section.settings.colors_button_label.red }}, {{ section.settings.colors_button_label.green }}, {{ section.settings.colors_button_label.blue }};
    --color-button-border: var(--color-button-background);
    --color-shadow: var(--color-foreground);
  }
{% endstyle %}

{% stylesheet %}
      .image-with-tabs.page-width {
        padding-top: var(--section-padding-top) !important;
        padding-bottom: var(--section-padding-bottom) !important;
      }

      .image-with-tabs__main-heading {
        max-width: 75rem;
        margin:1rem auto 3rem !important;
        text-align: center;
        /* margin-bottom: 3rem !important; edited */
      }

      .image-with-tabs__container {
        display: flex;
         background: var(--gradient-background);
        background-color: rgb(var(--color-background));
        padding:5rem;
        gap: 3rem;
        border-radius:16px;
        /* align-items: flex-start; */
        align-items: center;
      }
      .image-with-tabs__image-wrapper {
        flex: 1.5;
        position: relative;
        border-radius: 20px;
        background: #f5f5f5;
        overflow:visible;
        max-width: 700px;
        width: 100%;
        margin: auto;
      }

      .image-with-tabs__image {
        width: 100%;
        height: auto;
        border-radius: 20px;
        object-fit: cover;
      }

      .image-with-tabs__overlay {
        position: absolute;
        bottom: 27px;
        left: 20px;
        right: -80px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 20px;
        max-width: 40rem;
        margin-left:auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);

        @media (max-width: 1100px) {
        right: -30px;
        }
      }

      .image-with-tabs__overlay-text {
        margin-bottom: 10px;
        font-size:12px;
        letter-spacing:0;
        line-height:normal;
      }

      .image-with-tabs__accordion-title {
        font-weight: 400;
      }

      .image-with-tabs__overlay-author {
        font-size:14px;
      }

      .image-with-tabs__overlay-rating {
        display: flex;
        gap: 2px;
      }

      .image-with-tabs__star {
        color: #ffd700;
        font-size: 14px;
      }

      .image-with-tabs__content {
        flex: 1;
        display: flex;
        flex-direction: column;
        width:100%;
        gap: 1.5rem;
      }

      .image-with-tabs__block-heading {
        margin: 0;
      }

      .image-with-tabs__block-text {
        color: rgb(var(--color-foreground));
        font-size: 1rem;
        line-height: 1.5;
        margin: 0;
      }

      .image-with-tabs__block-button {
        background: rgb(var(--color-button-background)) !important;
        color: rgb(var(--color-button-text)) !important;
        border-color: rgb(var(--color-button-border)) !important;
        text-decoration: none;
        transition: all 0.3s ease;
        align-self: flex-start;
      }

      .image-with-tabs__block-button:hover {
        opacity: 0.8;
        color: rgb(var(--color-button-text)) !important;
      }

      .image-with-tabs__accordion {
        /* border: 1px solid rgba(var(--color-foreground), 0.2); */
        border-radius: 12px;
        overflow: hidden;
      }

      .image-with-tabs__accordion-summary {
        padding: 30px 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        /* background: rgba(var(--color-foreground), 0.05); edited */
        background:white;
        transition: background 0.3s ease;
        list-style: none;
      }

      .image-with-tabs__accordion-summary::-webkit-details-marker {
        display: none;
      }

      /* .image-with-tabs__accordion-summary:hover {

      } */

     .authur-rating-wrapper {
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
      .image-with-tabs__accordion-icon {
        width: 24px;
        height: 24px;
        /* border: 1px solid rgb(var(--color-foreground));
        border-radius: 50%; */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.3s ease;
        flex-shrink: 0;
      }

      .image-with-tabs__accordion-icon::before {
      content: '+';
      font-size: 44px;
      color: rgb(var(--color-foreground));
      line-height: 1;
      display: block;
      text-align: center;
      font-weight: normal;
    }

      .image-with-tabs__accordion[open] .image-with-tabs__accordion-icon {
        transform: rotate(45deg);
      }

      /* .image-with-tabs__accordion-content {
        padding: 0 20px 20px;
        color: rgb(var(--color-foreground));
        line-height: 1.5;
      } */
     .image-with-tabs__accordion-content {
      padding: 0 20px;
      color: rgb(var(--color-foreground));
      background:white;
      line-height: normal;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
    }
    .image-with-tabs__accordion-content p{
      margin:0 0 2rem;

    }

    .image-with-tabs__accordion[open] .image-with-tabs__accordion-content {
      padding-top: 0;
      /* padding-bottom: 20px; edited */
    }

    .image-with-tabs__accordion-icon {
      width: 24px;
      height: 24px;
      /* border: 1px solid rgb(var(--color-foreground));
      border-radius: 50%; */
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }
    .image-with-tabs__accordion-icon span {
        display: none;
    }

      /* Mobile Styles */
      @media screen and (max-width: 768px) {
      .image-with-tabs__main-heading {
        margin-bottom: 2rem;
      }

      .image-with-tabs__container {
        flex-direction: column;
        padding: 3rem 3rem 8.5rem 3rem;
        gap: 2rem;
      }

      .image-with-tabs__content {
        padding:2rem 0 0;
      }
      .image-with-tabs__overlay {
        max-width: 30rem;
        bottom: -50px;
        right: 40px;
      }
      .image-with-tabs__overlay-text{
        font-size:10px;
      }

      .image-with-tabs__accordion-summary {
        padding: 16px 20px;
      }

      .image-with-tabs.page-width {
        padding-top: calc(var(--section-padding-top) * 0.5) !important;
        padding-bottom: calc(var(--section-padding-bottom) * 0.5) !important;
      }
      .image-with-tabs__block-button {
        margin: 1rem auto 1rem;
    }
    }

    @media screen and (min-width: 769px) {
      .image-with-tabs__container {
        flex-direction: row;
      }
    }

      @media screen and (max-width: 480px) {
        /* .image-with-tabs__main-heading {
          font-size: 1.75rem;
        }

        .image-with-tabs__block-heading {
          font-size: 1.25rem;
        }

        .image-with-tabs__overlay {
          padding: 12px;
        }

        .image-with-tabs__overlay-text {
          font-size: 0.85rem;
        } */
      }
{% endstylesheet %}

<section class="image-with-tabs page-width">
  {% if section.settings.main_heading != blank %}
    <h2 class="image-with-tabs__main-heading h1">{{ section.settings.main_heading }}</h2>
  {% endif %}

  <div class="image-with-tabs__container">
    <div class="image-with-tabs__image-wrapper">
      {% if section.settings.image != blank %}
        <img
          src="{{ section.settings.image | image_url }}"
          alt="{{ section.settings.image.alt | default: section.settings.main_heading }}"
          class="image-with-tabs__image"
          loading="lazy"
          width="auto"
          height="auto"
        >
      {% endif %}

      {% if section.settings.overlay_text != blank or section.settings.overlay_author != blank %}
        <div class="image-with-tabs__overlay">
          {% if section.settings.overlay_text != blank %}
            <p class="image-with-tabs__overlay-text">{{ section.settings.overlay_text }}</p>
          {% endif %}

          <div class="authur-rating-wrapper">
            {% if section.settings.overlay_author != blank %}
              <div class="image-with-tabs__overlay-author">{{ section.settings.overlay_author }}</div>
            {% endif %}

            {% if section.settings.show_rating %}
              <div class="image-with-tabs__overlay-rating">
                {{ section.settings.show_rating | image_url: width: 100 | image_tag }}
              </div>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>

    {% if section.blocks.size > 0 %}
      <div class="image-with-tabs__content">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'heading' %}
              {% if block.settings.heading != blank %}
                <h3 class="image-with-tabs__block-heading" {{ block.shopify_attributes }}>
                  {{ block.settings.heading }}
                </h3>
              {% endif %}

            {% when 'text' %}
              {% if block.settings.text != blank %}
                <p class="image-with-tabs__block-text" {{ block.shopify_attributes }}>
                  {{ block.settings.text }}
                </p>
              {% endif %}

            {% when 'button' %}
              {% if block.settings.button_label != blank and block.settings.button_url != blank %}
                <a
                  href="{{ block.settings.button_url }}"
                  class="button button--middle image-with-tabs__block-button"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.button_label }}
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    width="21"
                    height="21"
                    viewBox="0 0 21 21"
                    fill="none"
                  >
                    <rect width="21" height="21" fill="url(#pattern0_83_1555)"/>
                    <defs>
                    <pattern id="pattern0_83_1555" patternContentUnits="objectBoundingBox" width="1" height="1">
                    <use xlink:href="#image0_83_1555" transform="scale(0.0232558)"/>
                    </pattern>
                    <image id="image0_83_1555" width="43" height="43" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAYAAADhXXHAAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5SURBVHgB7dfRDYIwEMbxq3EARugIjuAGroAbsIE6gSOwAhvgBoyAG+gG59fgg0IrPFC4xvslF5M+mL9N1UKklFIqOcxsMTWmwZxIsnfoJ7nBiGt5SGYwwgr2Ext81uCYfhyJK0mEsDwQXJJEGhzb3wSbwJtleNlRXAdM4VmvMEdjzJPGcHcJaXldta9t41lzO2ppXXsE2/6iL3Z8+5cx6Nj2F3BWbvhUF+rOVEZx2cD6tDO7FGxIGTivOUmioXNLIhQxWUqhjSfygYn9Lzmdhs4tmVAn8GWSF+rw8NYmM9Th70dwF25pBoYi4e73012EKlxK7qSUku0F2skMrndWbsQAAAAASUVORK5CYII="/>
                    </defs>
                  </svg>
                </a>
              {% endif %}

            {% when 'accordion' %}
              {% if block.settings.accordion_title != blank %}
                <details class="image-with-tabs__accordion" {{ block.shopify_attributes }} data-accordion>
                  <summary class="image-with-tabs__accordion-summary" data-summary>
                    <h4 class="image-with-tabs__accordion-title">{{ block.settings.accordion_title }}</h4>
                    <div class="image-with-tabs__accordion-icon"><span>+</span></div>
                  </summary>
                  {% if block.settings.accordion_content != blank %}
                    <div class="image-with-tabs__accordion-content">
                      {{ block.settings.accordion_content }}
                    </div>
                  {% endif %}
                </details>
              {% endif %}
          {% endcase %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const accordions = document.querySelectorAll('[data-accordion]');

    accordions.forEach((accordion) => {
      const summary = accordion.querySelector('[data-summary]');
      const content = accordion.querySelector('.image-with-tabs__accordion-content');

      // Set initial state
      content.style.maxHeight = '0px';
      content.style.overflow = 'hidden';
      accordion.removeAttribute('open'); // Ensure starting closed

      summary.addEventListener('click', function (e) {
        e.preventDefault(); // Prevent native toggle

        const isOpen = accordion.hasAttribute('open');

        if (isOpen) {
          // Closing
          content.style.maxHeight = content.scrollHeight + 'px'; // force start height
          requestAnimationFrame(() => {
            content.style.maxHeight = '0px';
          });

          setTimeout(() => {
            accordion.removeAttribute('open');
          }, 300); // Match CSS transition duration
        } else {
          // Close other accordions
          document.querySelectorAll('[data-accordion]').forEach((other) => {
            if (other !== accordion && other.hasAttribute('open')) {
              const otherContent = other.querySelector('.image-with-tabs__accordion-content');
              otherContent.style.maxHeight = otherContent.scrollHeight + 'px';
              requestAnimationFrame(() => {
                otherContent.style.maxHeight = '0px';
              });
              setTimeout(() => {
                other.removeAttribute('open');
              }, 300);
            }
          });

          accordion.setAttribute('open', ''); // Set open manually
          content.style.maxHeight = '0px';
          requestAnimationFrame(() => {
            content.style.maxHeight = content.scrollHeight + 'px';
          });
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Image With Tabs",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Main Content"
    },
    {
      "type": "text",
      "id": "main_heading",
      "label": "Main heading",
      "default": "Try your personalized care plan risk-free for 60 days."
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "header",
      "content": "Image Overlay"
    },
    {
      "type": "textarea",
      "id": "overlay_text",
      "label": "Overlay text",
      "default": "I enjoy Thyroid online care could feel like personal. My provider takes the time to understand my needs and adjust my treatment. The flexibility of scheduling has made it easy to stay consistent, and I've noticed real improvements to my health and confidence."
    },
    {
      "type": "text",
      "id": "overlay_author",
      "label": "Overlay author",
      "default": "Amanda R."
    },
    {
      "type": "image_picker",
      "id": "show_rating",
      "label": "Show star rating"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "colors_background",
      "label": "Background color",
      "default": "#f8f9fa"
    },
    {
      "type": "color_background",
      "id": "gradient_background",
      "label": "Gradient background"
    },
    {
      "type": "color",
      "id": "colors_text",
      "label": "Text color",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "colors_button_background",
      "label": "Button background color",
      "default": "#1a237e"
    },
    {
      "type": "color",
      "id": "colors_button_label",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Section Padding & Margin"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Margin Top",
      "default": 60
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Margin padding",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "heading",
      "name": "Heading",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Care that adapts to your needs"
        }
      ]
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Text",
          "default": "Our personalized approach ensures you get the right treatment at the right time."
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "default": "Start Your Visit"
        },
        {
          "type": "url",
          "id": "button_url",
          "label": "Button URL"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        {
          "type": "text",
          "id": "accordion_title",
          "label": "Accordion title",
          "default": "Guarantee details"
        },
        {
          "type": "richtext",
          "id": "accordion_content",
          "label": "Accordion content",
          "default": "<p>Your satisfaction is guaranteed with our 60-day risk-free trial. If you're not completely satisfied with your results, we'll provide a full refund.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image With Tabs",
      "blocks": [
        {
          "type": "heading",
          "settings": {
            "heading": "Care that adapts to your needs"
          }
        },
        {
          "type": "accordion",
          "settings": {
            "accordion_title": "Guarantee details"
          }
        },
        {
          "type": "button",
          "settings": {
            "button_label": "Start Your Visit"
          }
        }
      ]
    }
  ]
}
{% endschema %}
